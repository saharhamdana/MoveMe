<!-- ========================================== -->
<!-- HEADER DYNAMIQUE -->
<!-- ========================================== -->
<ion-header>
  <ion-toolbar [color]="isOnline ? 'success' : 'medium'">
    <ion-title>
      {{ isOnline ? 'üü¢ EN LIGNE' : 'üî¥ HORS LIGNE' }}
    </ion-title>
  </ion-toolbar>
</ion-header>

<!-- ========================================== -->
<!-- CONTENU -->
<!-- ========================================== -->
<ion-content>

  <!-- Rafra√Æchir -->
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div *ngIf="currentUser" class="home-container">

    <!-- ========================================== -->
    <!-- CARTE STATUT PRINCIPAL -->
    <!-- ========================================== -->
    <ion-card class="status-card" [class.online]="isOnline">
      <ion-card-header>
        <ion-card-title>Votre statut</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        
        <!-- Switch Online/Offline -->
        <div class="status-toggle">
          <div class="status-text">
            <h3>{{ isOnline ? 'En ligne' : 'Hors ligne' }}</h3>
            <p>
              {{ isOnline 
                ? 'Vous recevez des demandes de courses' 
                : 'Activez pour recevoir des courses' 
              }}
            </p>
          </div>
          <ion-toggle 
            [(ngModel)]="isOnline" 
            (ionChange)="toggleOnlineStatus($event)"
            [color]="isOnline ? 'success' : 'medium'"
            class="status-switch"
          ></ion-toggle>
        </div>

        <!-- Indicateur visuel -->
        <div class="status-indicator" [class.active]="isOnline">
          <div class="pulse-ring" *ngIf="isOnline"></div>
          <div class="status-dot"></div>
        </div>

      </ion-card-content>
    </ion-card>

    <!-- ========================================== -->
    <!-- STATISTIQUES DU JOUR -->
    <!-- ========================================== -->
    <div class="today-stats">
      <ion-card class="stat-card">
        <ion-card-content>
          <ion-icon name="cash-outline" color="success"></ion-icon>
          <div>
            <h3>{{ todayEarnings }} DT</h3>
            <p>Aujourd'hui</p>
          </div>
        </ion-card-content>
      </ion-card>

      <ion-card class="stat-card">
        <ion-card-content>
          <ion-icon name="car-sport-outline" color="primary"></ion-icon>
          <div>
            <h3>{{ todayRides }}</h3>
            <p>Courses</p>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- ========================================== -->
    <!-- DEMANDES EN ATTENTE (SI EN LIGNE) -->
    <!-- ========================================== -->
    <ion-card *ngIf="isOnline" class="requests-card" (click)="viewRideRequests()" button>
      <ion-card-content>
        <div class="requests-content">
          <div class="requests-icon">
            <ion-icon name="notifications-outline"></ion-icon>
            <ion-badge *ngIf="pendingRides > 0" color="danger">{{ pendingRides }}</ion-badge>
          </div>
          <div>
            <h3>Demandes de courses</h3>
            <p>{{ pendingRides === 0 ? 'Aucune demande pour le moment' : pendingRides + ' demande(s) en attente' }}</p>
          </div>
          <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- ========================================== -->
    <!-- MESSAGE SI HORS LIGNE -->
    <!-- ========================================== -->
    <ion-card *ngIf="!isOnline" class="offline-card">
      <ion-card-content>
        <ion-icon name="moon-outline" color="medium"></ion-icon>
        <div>
          <h3>Vous √™tes hors ligne</h3>
          <p>Activez votre statut en ligne pour commencer √† recevoir des demandes de courses et augmenter vos gains.</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- ========================================== -->
    <!-- INFORMATIONS DU CHAUFFEUR -->
    <!-- ========================================== -->
    <ion-card class="driver-info-card">
      <ion-card-header>
        <ion-card-title>Vos informations</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        
        <ion-list lines="none">
          
          <!-- Nom -->
          <ion-item>
            <ion-icon name="person-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>{{ currentUser.displayName }}</h3>
              <p>Chauffeur professionnel</p>
            </ion-label>
          </ion-item>

          <!-- Email -->
          <ion-item>
            <ion-icon name="mail-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>{{ currentUser.email }}</h3>
              <p>Email</p>
            </ion-label>
          </ion-item>

          <!-- T√©l√©phone -->
          <ion-item>
            <ion-icon name="call-outline" slot="start" color="primary"></ion-icon>
            <ion-label>
              <h3>{{ currentUser.phoneNumber }}</h3>
              <p>T√©l√©phone</p>
            </ion-label>
          </ion-item>

          <!-- Note -->
          <ion-item>
            <ion-icon name="star-outline" slot="start" color="warning"></ion-icon>
            <ion-label>
              <h3>‚≠ê {{ currentUser.rating }}/5</h3>
              <p>{{ currentUser.totalRides }} courses effectu√©es</p>
            </ion-label>
          </ion-item>

        </ion-list>

      </ion-card-content>
    </ion-card>

    <!-- ========================================== -->
    <!-- STATISTIQUES GLOBALES -->
    <!-- ========================================== -->
    <ion-card *ngIf="driverData" class="global-stats-card">
      <ion-card-header>
        <ion-card-title>Vos performances</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        
        <div class="stats-grid">
          
          <!-- Gains totaux -->
          <div class="stat-item">
            <ion-icon name="cash-outline" color="success"></ion-icon>
            <div>
              <h4>{{ driverData.earnings?.totalEarnings || 0 }} DT</h4>
              <p>Gains totaux</p>
            </div>
          </div>

          <!-- Gains semaine -->
          <div class="stat-item">
            <ion-icon name="trending-up-outline" color="primary"></ion-icon>
            <div>
              <h4>{{ driverData.earnings?.weeklyEarnings || 0 }} DT</h4>
              <p>Cette semaine</p>
            </div>
          </div>

          <!-- Courses totales -->
          <div class="stat-item">
            <ion-icon name="car-sport-outline" color="tertiary"></ion-icon>
            <div>
              <h4>{{ driverData.earnings?.totalRides || 0 }}</h4>
              <p>Courses totales</p>
            </div>
          </div>

          <!-- Courses semaine -->
          <div class="stat-item">
            <ion-icon name="time-outline" color="warning"></ion-icon>
            <div>
              <h4>{{ driverData.earnings?.weeklyRides || 0 }}</h4>
              <p>Cette semaine</p>
            </div>
          </div>

        </div>

      </ion-card-content>
    </ion-card>

    <!-- ========================================== -->
    <!-- CONSEILS -->
    <!-- ========================================== -->
    <ion-card class="tips-card">
      <ion-card-content>
        <ion-icon name="bulb-outline" color="warning"></ion-icon>
        <div>
          <h3>üí° Conseil du jour</h3>
          <p *ngIf="!isOnline">Passez en ligne pour commencer √† gagner de l'argent !</p>
          <p *ngIf="isOnline">Les heures de pointe sont entre 7h-9h et 17h-20h. Restez en ligne pour maximiser vos gains !</p>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- ========================================== -->
    <!-- BOUTON D√âCONNEXION -->
    <!-- ========================================== -->
    <ion-button 
      expand="block" 
      color="danger" 
      fill="outline"
      (click)="logout()"
      class="logout-btn"
    >
      <ion-icon name="log-out-outline" slot="start"></ion-icon>
      D√©connexion
    </ion-button>

  </div>

</ion-content>